<meta http-equiv="Content-type" content="text/html;charset=UTF-8"> 
<html>
	<head>
		<title>Visualization of Edges and Vertices   -- Author: Yitao Li</title>
		<script src="js/d3.v2.js"></script>
		<script src="js/jquery-1.8.2.min.js"></script>
		<script>
			var max_lat = -90, min_lat = 90, max_lon = -180, min_lon = 180;
			$(document).ready(function(){
				$("#loading").fadeIn(100);
				$.ajax({
					async: true,
					url: "WA_Vertices.txt",
					beforeSend: function ( xhr ) {
						xhr.overrideMimeType("text/plain; charset=utf-8");
					}
				}).done(function ( data ) {
					$("#WA_Vertices_data").html(data);
				});
				$.ajax({
					async: true,
					url: "WA_Edges.txt",
					beforeSend: function ( xhr ) {
						xhr.overrideMimeType("text/plain; charset=utf-8");
					}
				}).done(function ( data ){
					$("#WA_Edges_data").html(data);
					var width = 800, height = 600, w, h, i, str_id, str_lat, str_lon, id, lat, lon, str_a, str_b, a, b, cost, clr, viz = d3.select("#viz").append("svg:svg").attr("width", width).attr("height", height), v_str = $("#WA_Vertices_data").html().split(/[ \n]+/), e_str = $("#WA_Edges_data").html().split(/[ \n]+/), v_lat = new Array(), v_lon = new Array();
					for (i = 0; i < v_str.length;){
						str_id = v_str[i++]; str_lat = v_str[i++]; str_lon = v_str[i++];
						id = parseInt(str_id); lat = parseFloat(str_lat); lon = parseFloat(str_lon);
						v_lat[id] = lat; v_lon[id] = lon;	
						if (lat < min_lat){
							min_lat = lat;
						}else if (lat > max_lat){
							max_lat = lat;
						}
						if (lon < min_lon){
							min_lon = lon;
						}else if (lon > max_lon){
							max_lon = lon;
						}
						$("#WA_Vertices").append("<option>" + str_id + ": (" + str_lat + ", " + str_lon + ")</option>");
					}
					h = max_lat - min_lat;
					w = max_lon - min_lon;
					for (i = 1; i < e_str.length;){
						str_a = e_str[i];
						a = parseInt(str_a);   //skipping edge id
						++i;
						str_b = e_str[i];
						b = parseInt(str_b);
						++i;
						cost = parseFloat(e_str[i]);
						i += 2;
						if (cost > 255.0){
							clr = 255;
						}else{
							clr = Math.floor(256 * (1 - Math.exp(-cost / 12.0)));
						}
						$("#WA_Edges").append("<option>(" + str_a + ", " + str_b + ")</option>");
						viz.append("svg:line").attr("y1", height - (v_lat[a] - min_lat) / h * height).attr("y2", height - (v_lat[b] - min_lat) / h * height).attr("x1", (v_lon[a] - min_lon) / w * width).attr("x2", (v_lon[b] - min_lon) / w * width).style("stroke", "rgb(" + (255 - clr).toString() + ", " + clr.toString() + ", 20)").style("stroke-width", .5);
					}
					$("#loading").fadeOut(100);
					$("#demo").fadeIn(100);
				});
			});
		</script>
	</head> 
	<body>   
		<div id="loading" style="distplay:none;">
			<table border="0" cellpadding="0" cellspacing="0" style="width: 800px; height: 600px; float: left; clear: left;">
				<tr><td width="100%" height="100%" style=" background-image:url('loading.gif');background-repeat:no-repeat;background-size: 75%;"><font size="80" color="red">LOADING...</font></td></tr>
			</table>
		</div>
		<div id="demo" style="display:none;"> 
			<table>
				<tr>
					<th>Vertex List (Vertex ID, Vertex Lat, Vertex Lon)</th> 
					<th>Edge List (Vertex ID, Vertex ID)</th> 
					<th>Vertex-and-Edge Representation</th>
				</tr>
				<tr>
					<td align="top">
						<select id="WA_Vertices" size="30"></select>
					</td>
					<td align="top">
						<select id="WA_Edges" size="30"></select>
					</td>
					<td align="top">
						<div id="viz"></div>
					</td>
				</tr>
			</table>
		</div>
		<div id="WA_Vertices_data" style="display:none;"></div>
		<div id="WA_Edges_data" style="display:none"></div>
	</body>
</html>
